package com.pwc.Virtualized.Assets.virtualizedAsset.Controller;

import static com.pwc.Virtualized.Assets.virtualizedAsset.utils.SAPConstants.FINALJSON;

import java.time.Instant;

import org.json.JSONException;
import org.json.JSONObject;
import org.json.XML;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.google.gson.Gson;
import com.jayway.jsonpath.DocumentContext;
import com.jayway.jsonpath.JsonPath;
import com.pwc.Virtualized.Assets.virtualizedAsset.model.TemporaryModel;
import com.pwc.Virtualized.Assets.virtualizedAsset.service.TemporaryService;
import com.pwc.Virtualized.Assets.virtualizedAsset.service.XmlFromSAPService;

@RestController // This means that this class is a Controller
@RequestMapping(path = "/Order") // This means URL's start with /Order (after Application path)
public class SAPController {

	/*
	 * @Autowired // This means to get the bean called userRepository // Which is
	 * auto-generated by Spring, we will use it to handle the data private
	 * UserRepository userRepository;
	 */

	@Autowired
	private XmlFromSAPService xmlFromSAP;

	@Autowired
	private TemporaryService temporaryService;

	@GetMapping(path = "/PONumber/{PONumber}", produces = { "application/json" })
	public ResponseEntity<Object> getOrderDetailsFromPoNumber(@PathVariable("PONumber") int poNumber)
			throws JSONException {

		JSONObject response = new JSONObject(
				"{\"Count\":1,\"NextLink\":null,\"Orders\":[{\"Account\":\"PRICEWATERHOUSECOOPERS\",\"AccountNumber\":\"1038314\",\"BillTo\":{\"Attention\":null,\"City\":\"New York\",\"Country\":\"United States\",\"CountryCode\":\"USA\",\"County\":null,\"DeliveryAddress\":\"90 New York Park Avenue\",\"PostalCode\":\"10016\",\"Recipient\":\"PRICEWATERHOUSECOOPERS\",\"StateProvince\":\"NY\"},\"CurrencyCode\":\"USD\",\"DeliveryMemo\":null,\"DeliveryMode\":\"UPS GROUND\",\"InvoiceNumber\":null,\"InvoiceNumberList\":[],\"ItemList\":[{\"Description\":\"CTO MACBOOK AIR M2 8C 8C GPU13.6IN 16GB 512GB SSD 30W SPACE\",\"EndUserList\":[{\"Email\":\"YASH.BAFANA@PWC.COM\",\"Fax\":null,\"Name\":\"Yash Bafana\",\"Phone\":\"9178030185\"}],\"LineNumber\":1,\"POLineNumber\":\"0000000001\",\"MaintenanceBeginsOn\":null,\"MaintenanceExpiresOn\":null,\"Manufacturer\":\"Apple\",\"MPN\":\"Z15S000D2\",\"SPN\":\"45197566\",\"Quantity\":1,\"RelatedDataList\":[],\"Shipments\":[],\"Status\":\"OPEN ORDER\",\"UnitPrice\":1539.61},{\"Description\":\"AppleCare for Enterprise for MacBook Air (M2) 36 months Tier\",\"EndUserList\":[],\"LineNumber\":2,\"POLineNumber\":\"0000000001\",\"MaintenanceBeginsOn\":null,\"MaintenanceExpiresOn\":null,\"Manufacturer\":\"Apple\",\"MPN\":\"SFGD2LL\\/A\",\"SPN\":\"45211916\",\"Quantity\":1,\"RelatedDataList\":[],\"Shipments\":[],\"Status\":\"OPEN ORDER\",\"UnitPrice\":0},{\"Description\":\"SenseAGE Magnetic Privacy Screen Filter forMacBook Air 13.6\",\"EndUserList\":[{\"Email\":\"YASH.BAFANA@PWC.COM\",\"Fax\":null,\"Name\":\"Yash Bafana\",\"Phone\":\"9178030185\"}],\"LineNumber\":3,\"POLineNumber\":\"0000000001\",\"MaintenanceBeginsOn\":null,\"MaintenanceExpiresOn\":null,\"Manufacturer\":\"Senseage Co.,LTD.\",\"MPN\":\"SP-PVM-MA136RE-2022\",\"SPN\":\"45922405\",\"Quantity\":1,\"RelatedDataList\":[],\"Shipments\":[],\"Status\":\"OPEN ORDER\",\"UnitPrice\":28.5},{\"Description\":\"HP USB-C to RJ45 Adapter G2 - network adapter - USB-C - Giga\",\"EndUserList\":[{\"Email\":\"YASH.BAFANA@PWC.COM\",\"Fax\":null,\"Name\":\"Yash Bafana\",\"Phone\":\"9178030185\"}],\"LineNumber\":4,\"POLineNumber\":\"0000000001\",\"MaintenanceBeginsOn\":null,\"MaintenanceExpiresOn\":null,\"Manufacturer\":\"HP, Inc.\",\"MPN\":\"4Z527AA\",\"SPN\":\"44536514\",\"Quantity\":2,\"RelatedDataList\":[],\"Shipments\":[],\"Status\":\"OPEN ORDER\",\"UnitPrice\":15.21},{\"Description\":\"Belkin - Patch cable - RJ-45 (M) - RJ-45 (M) - 1.8 m - UTP\",\"EndUserList\":[{\"Email\":\"YASH.BAFANA@PWC.COM\",\"Fax\":null,\"Name\":\"Yash Bafana\",\"Phone\":\"9178030185\"}],\"LineNumber\":5,\"POLineNumber\":\"0000000001\",\"MaintenanceBeginsOn\":null,\"MaintenanceExpiresOn\":null,\"Manufacturer\":\"Belkin\",\"MPN\":\"A3L791-06\",\"SPN\":\"12460539\",\"Quantity\":1,\"RelatedDataList\":[],\"Shipments\":[],\"Status\":\"OPEN ORDER\",\"UnitPrice\":2.68},{\"Description\":\"PC Config- Asset Tagging with Reporting-Per1xUnit-Standalone\",\"EndUserList\":[{\"Email\":\"YASH.BAFANA@PWC.COM\",\"Fax\":null,\"Name\":\"Yash Bafana\",\"Phone\":\"9178030185\"}],\"LineNumber\":6,\"POLineNumber\":\"0000000001\",\"MaintenanceBeginsOn\":null,\"MaintenanceExpiresOn\":null,\"Manufacturer\":\"SHI CONFIG\",\"MPN\":\"ICO-TAG-2A\",\"SPN\":\"44672784\",\"Quantity\":1,\"RelatedDataList\":[],\"Shipments\":[],\"Status\":\"OPEN ORDER\",\"UnitPrice\":34},{\"Description\":\"CustomKitting-Combine Items InAs Few Boxes PossiblePer1xBox\",\"EndUserList\":[{\"Email\":\"YASH.BAFANA@PWC.COM\",\"Fax\":null,\"Name\":\"Yash Bafana\",\"Phone\":\"9178030185\"}],\"LineNumber\":7,\"POLineNumber\":\"0000000001\",\"MaintenanceBeginsOn\":null,\"MaintenanceExpiresOn\":null,\"Manufacturer\":\"SHI CONFIG\",\"MPN\":\"ICO-KIT-BOX\",\"SPN\":\"33356723\",\"Quantity\":1,\"RelatedDataList\":[],\"Shipments\":[],\"Status\":\"OPEN ORDER\",\"UnitPrice\":0},{\"Description\":\"PwC PC Refresh Return Label  Ingram\",\"EndUserList\":[{\"Email\":\"YASH.BAFANA@PWC.COM\",\"Fax\":null,\"Name\":\"Yash Bafana\",\"Phone\":\"9178030185\"}],\"LineNumber\":8,\"POLineNumber\":\"0000000001\",\"MaintenanceBeginsOn\":null,\"MaintenanceExpiresOn\":null,\"Manufacturer\":\"SHI International Corp\",\"MPN\":\"NPN-PWC-RETURN-INGRAM\",\"SPN\":\"46111466\",\"Quantity\":1,\"RelatedDataList\":[],\"Shipments\":[],\"Status\":\"OPEN ORDER\",\"UnitPrice\":0}],\"Number\":\"S58847172\",\"OrderedOn\":\"2023-12-15T00:00:00Z\",\"PaymentTerms\":null,\"PONumber\":\"3501059171\",\"QuoteNumber\":null,\"RelatedDataList\":[{\"Label\":\"Buyer_ID\",\"Value\":\"0000000043\"},{\"Label\":\"Contract_ID\",\"Value\":\"NO CONTRACT\"},{\"Label\":\"Supplier_ID\",\"Value\":\"0020030325\"}],\"ShipTo\":{\"Attention\":null,\"City\":\"New York\",\"Country\":\"United States\",\"CountryCode\":\"USA\",\"County\":null,\"DeliveryAddress\":\"360 W 43RD ST, APT S8D\",\"PostalCode\":\"10036\",\"Recipient\":\"Yash Bafana_\",\"StateProvince\":\"NY\"},\"Status\":\"OPEN ORDER\",\"TouchedOnUTC\":\"2023-12-15T16:03:06.587Z\"}]}");
		// System.out.println(response.get("Name"));
		// String response =
		// "{\"Email\":\"YASH.BAFANA@PWC.COM\",\"Fax\":null,\"Name\":\"Yash
		// Bafana\",\"Phone\":\"9178030185\"}";
		String response2 = response.toString();

		return new ResponseEntity<>(response2, HttpStatus.OK);
	}

	@PostMapping(path = "/XMLData", produces = { "application/json", "application/xml" }, consumes = {
			"application/xml", "application/json" })
	public ResponseEntity<Object> getXMLFromSAP(@RequestBody Object temporaryModel)
			throws JSONException, JsonProcessingException {

		TemporaryModel xml = new TemporaryModel();
		// ObjectMapper map = new ObjectMapper();
		String json = new Gson().toJson(temporaryModel);
		JSONObject xmlJSONObj = new JSONObject(json);
		xml.setSapxml(xmlJSONObj.toString());

		xml.setDocumentid(xmlJSONObj.getJSONObject("Body").getJSONObject("Document").getJSONObject("BusinessDocument")
				.getJSONObject("PurchaseOrderHeader").getString("DocumentID"));

		xmlFromSAP.addXML(xml);

		return new ResponseEntity<>("happy coding", HttpStatus.OK);
	}

	@GetMapping(path = "/documentId/{documentId}", produces = { "application/json" })
	public ResponseEntity<String> getTemporaryData(@PathVariable("documentId") Long documentId)
			throws JSONException {

		JSONObject response = new JSONObject(FINALJSON);

		// System.out.println(response.get("Name"));
		// String response =
		// "{\"Email\":\"YASH.BAFANA@PWC.COM\",\"Fax\":null,\"Name\":\"Yash
		// Bafana\",\"Phone\":\"9178030185\"}";

		// String response2 = response.toString();
		String getxmlDetails = temporaryService.getxmlDetails(documentId, response);

		return new ResponseEntity<>(getxmlDetails, HttpStatus.OK);
	}

	/*
	 * public static void main(String[] args) throws JSONException {
	 * 
	 * 
	 * 
	 * 
	 * JSONObject xmlJSONObj = XML.
	 * toJSONObject("<Envelope><Body><Document><BusinessProcess>PurchaseOrder</BusinessProcess><BusinessDocument><PurchaseOrderHeader><DocumentID>3501059201</DocumentID><DocumentDate>2023-12-15</DocumentDate><Language>EN</Language><Currency>USD</Currency><TradingPartners><SoldToParty><PartnerID type=\"Buyer\">0000000043</PartnerID><Address><CompanyName1>NO CONTRACT</CompanyName1><CompanyName2>PwC US Group LLP</CompanyName2><Street>W Boy Scout Blvd</Street><HouseNumber>4040</HouseNumber><City>Tampa</City><PostalCode>33607</PostalCode><Region>FL</Region><Country>US</Country><TelephoneNumber>(55) 5263 60 00</TelephoneNumber><FaxNumber>813287000</FaxNumber><EmailAddress>us_procurement-operations--data@pwc.com</EmailAddress></Address></SoldToParty><ShipToParty><PartnerID type=\"Buyer\">0000003468</PartnerID><Address><CompanyName1>ATS-User</CompanyName1><CompanyName2>Asset Tracking system user</CompanyName2><Street>3109 W Dr ML King Blvd</Street><City>Tampa</City><PostalCode>33607</PostalCode><Region>FL</Region><Country>US</Country><FirstName>EBP</FirstName><LastName>Exchange</LastName><EmailAddress>gfs.support.procurement@us.pwc.com</EmailAddress></Address></ShipToParty><Vendor><PartnerID type=\"Buyer\">0020030325</PartnerID><Address><CompanyName1>SHI INTERNATIONAL CORP</CompanyName1><CompanyName2>PO VENDOR</CompanyName2><Street>290 DAVIDSON AVENUE</Street><City>SOMERSET</City><PostalCode>08873</PostalCode><Region>NJ</Region><Country>US</Country><TelephoneNumber>1-732 764 9393</TelephoneNumber><FaxNumber>1-732-805-9669</FaxNumber><EmailAddress>Kerina_Crosdale@shi.com</EmailAddress></Address></Vendor></TradingPartners><Purpose>New</Purpose><FollowUpActions><Confirmation>NotExpected</Confirmation><Invoice>Expected</Invoice></FollowUpActions><Description>90DAY SJOD 20231228 2000228285 47208737</Description></PurchaseOrderHeader><LineItem><ItemID>0000000001</ItemID><ShipToAddress><CompanyName1>Aditi Dani</CompanyName1><Street>1037 MODENA ST</Street><City>TRACY</City><PostalCode>95391</PostalCode><Region>CA</Region><Country>US</Country><TelephoneNumber>+1 209-673-1027</TelephoneNumber></ShipToAddress><RequestedDeliveryDate>2023-12-28</RequestedDeliveryDate><RequestedQuantity UoM=\"EA\">1.000</RequestedQuantity><RequestedPrice><Price Currency=\"USD\">1778.6000</Price><PriceUnit>1</PriceUnit></RequestedPrice><Product><Type>Material</Type><VendorProductID>47208737</VendorProductID><Description>Surface Laptop 5 15INI7-32GB-512 WIN 11</Description></Product><ItemText Language=\"EN\">ADANI006~SJOD~Aditi Sheshagirisa Dani~ADITI.DANI@PWC.COM~Advisory~1037 MODENA ST 5CG0218WBJ +1 209-673-1027 TRACY CA 95391 US</ItemText><ActionCode>Added</ActionCode><Category><CategoryID>43211503</CategoryID></Category></LineItem></BusinessDocument></Document></Body></Envelope>"
	 * );
	 * 
	 * 
	 * JSONObject xmlJSONObj = new
	 * JSONObject("{\"Count\":1,\"NextLink\":null,\"Orders\":[{\"Account\":\"PRICEWATERHOUSECOOPERS\",\"AccountNumber\":\"1038314\",\"BillTo\":{\"Attention\":null,\"City\":\"New York\",\"Country\":\"United States\",\"CountryCode\":\"USA\",\"County\":null,\"DeliveryAddress\":\"90 New York Park Avenue\",\"PostalCode\":\"10016\",\"Recipient\":\"PRICEWATERHOUSECOOPERS\",\"StateProvince\":\"NY\"},\"CurrencyCode\":\"USD\",\"DeliveryMemo\":null,\"DeliveryMode\":\"UPS GROUND\",\"InvoiceNumber\":null,\"InvoiceNumberList\":[],\"ItemList\":[{\"Description\":\"CTO MACBOOK AIR M2 8C 8C GPU13.6IN 16GB 512GB SSD 30W SPACE\",\"EndUserList\":[{\"Email\":\"YASH.BAFANA@PWC.COM\",\"Fax\":null,\"Name\":\"Yash Bafana\",\"Phone\":\"9178030185\"}],\"LineNumber\":1,\"POLineNumber\":\"0000000001\",\"MaintenanceBeginsOn\":null,\"MaintenanceExpiresOn\":null,\"Manufacturer\":\"Apple\",\"MPN\":\"Z15S000D2\",\"SPN\":\"45197566\",\"Quantity\":1,\"RelatedDataList\":[],\"Shipments\":[],\"Status\":\"OPEN ORDER\",\"UnitPrice\":1539.61},{\"Description\":\"AppleCare for Enterprise for MacBook Air (M2) 36 months Tier\",\"EndUserList\":[],\"LineNumber\":2,\"POLineNumber\":\"0000000001\",\"MaintenanceBeginsOn\":null,\"MaintenanceExpiresOn\":null,\"Manufacturer\":\"Apple\",\"MPN\":\"SFGD2LL\\/A\",\"SPN\":\"45211916\",\"Quantity\":1,\"RelatedDataList\":[],\"Shipments\":[],\"Status\":\"OPEN ORDER\",\"UnitPrice\":0},{\"Description\":\"SenseAGE Magnetic Privacy Screen Filter forMacBook Air 13.6\",\"EndUserList\":[{\"Email\":\"YASH.BAFANA@PWC.COM\",\"Fax\":null,\"Name\":\"Yash Bafana\",\"Phone\":\"9178030185\"}],\"LineNumber\":3,\"POLineNumber\":\"0000000001\",\"MaintenanceBeginsOn\":null,\"MaintenanceExpiresOn\":null,\"Manufacturer\":\"Senseage Co.,LTD.\",\"MPN\":\"SP-PVM-MA136RE-2022\",\"SPN\":\"45922405\",\"Quantity\":1,\"RelatedDataList\":[],\"Shipments\":[],\"Status\":\"OPEN ORDER\",\"UnitPrice\":28.5},{\"Description\":\"HP USB-C to RJ45 Adapter G2 - network adapter - USB-C - Giga\",\"EndUserList\":[{\"Email\":\"YASH.BAFANA@PWC.COM\",\"Fax\":null,\"Name\":\"Yash Bafana\",\"Phone\":\"9178030185\"}],\"LineNumber\":4,\"POLineNumber\":\"0000000001\",\"MaintenanceBeginsOn\":null,\"MaintenanceExpiresOn\":null,\"Manufacturer\":\"HP, Inc.\",\"MPN\":\"4Z527AA\",\"SPN\":\"44536514\",\"Quantity\":2,\"RelatedDataList\":[],\"Shipments\":[],\"Status\":\"OPEN ORDER\",\"UnitPrice\":15.21},{\"Description\":\"Belkin - Patch cable - RJ-45 (M) - RJ-45 (M) - 1.8 m - UTP\",\"EndUserList\":[{\"Email\":\"YASH.BAFANA@PWC.COM\",\"Fax\":null,\"Name\":\"Yash Bafana\",\"Phone\":\"9178030185\"}],\"LineNumber\":5,\"POLineNumber\":\"0000000001\",\"MaintenanceBeginsOn\":null,\"MaintenanceExpiresOn\":null,\"Manufacturer\":\"Belkin\",\"MPN\":\"A3L791-06\",\"SPN\":\"12460539\",\"Quantity\":1,\"RelatedDataList\":[],\"Shipments\":[],\"Status\":\"OPEN ORDER\",\"UnitPrice\":2.68},{\"Description\":\"PC Config- Asset Tagging with Reporting-Per1xUnit-Standalone\",\"EndUserList\":[{\"Email\":\"YASH.BAFANA@PWC.COM\",\"Fax\":null,\"Name\":\"Yash Bafana\",\"Phone\":\"9178030185\"}],\"LineNumber\":6,\"POLineNumber\":\"0000000001\",\"MaintenanceBeginsOn\":null,\"MaintenanceExpiresOn\":null,\"Manufacturer\":\"SHI CONFIG\",\"MPN\":\"ICO-TAG-2A\",\"SPN\":\"44672784\",\"Quantity\":1,\"RelatedDataList\":[],\"Shipments\":[],\"Status\":\"OPEN ORDER\",\"UnitPrice\":34},{\"Description\":\"CustomKitting-Combine Items InAs Few Boxes PossiblePer1xBox\",\"EndUserList\":[{\"Email\":\"YASH.BAFANA@PWC.COM\",\"Fax\":null,\"Name\":\"Yash Bafana\",\"Phone\":\"9178030185\"}],\"LineNumber\":7,\"POLineNumber\":\"0000000001\",\"MaintenanceBeginsOn\":null,\"MaintenanceExpiresOn\":null,\"Manufacturer\":\"SHI CONFIG\",\"MPN\":\"ICO-KIT-BOX\",\"SPN\":\"33356723\",\"Quantity\":1,\"RelatedDataList\":[],\"Shipments\":[],\"Status\":\"OPEN ORDER\",\"UnitPrice\":0},{\"Description\":\"PwC PC Refresh Return Label  Ingram\",\"EndUserList\":[{\"Email\":\"YASH.BAFANA@PWC.COM\",\"Fax\":null,\"Name\":\"Yash Bafana\",\"Phone\":\"9178030185\"}],\"LineNumber\":8,\"POLineNumber\":\"0000000001\",\"MaintenanceBeginsOn\":null,\"MaintenanceExpiresOn\":null,\"Manufacturer\":\"SHI International Corp\",\"MPN\":\"NPN-PWC-RETURN-INGRAM\",\"SPN\":\"46111466\",\"Quantity\":1,\"RelatedDataList\":[],\"Shipments\":[],\"Status\":\"OPEN ORDER\",\"UnitPrice\":0}],\"Number\":\"S58847172\",\"OrderedOn\":\"2023-12-15T00:00:00Z\",\"PaymentTerms\":null,\"PONumber\":\"3501059171\",\"QuoteNumber\":null,\"RelatedDataList\":[{\"Label\":\"Buyer_ID\",\"Value\":\"0000000043\"},{\"Label\":\"Contract_ID\",\"Value\":\"NO CONTRACT\"},{\"Label\":\"Supplier_ID\",\"Value\":\"0020030325\"}],\"ShipTo\":{\"Attention\":null,\"City\":\"New York\",\"Country\":\"United States\",\"CountryCode\":\"USA\",\"County\":null,\"DeliveryAddress\":\"360 W 43RD ST, APT S8D\",\"PostalCode\":\"10036\",\"Recipient\":\"Yash Bafana_\",\"StateProvince\":\"NY\"},\"Status\":\"OPEN ORDER\",\"TouchedOnUTC\":\"2023-12-15T16:03:06.587Z\"}]}"
	 * );
	 * 
	 * DocumentContext doc = JsonPath.parse(xmlJSONObj.toString());
	 * //doc.set("level-1.level-2.level-3.level-4b[0].level-4b-3.StartDate",
	 * Instant.now().toString());
	 * doc.set("Orders[0].ItemList[0].EndUserList[0].Email",
	 * "nazish.a.ansari@pwc.com"); System.out.println(doc.jsonString());
	 * 
	 * 
	 * 
	 * System.out.println(xmlJSONObj.getJSONObject("Envelope").getJSONObject("Body")
	 * .getJSONObject("Document").getJSONObject("BusinessDocument").getJSONObject(
	 * "PurchaseOrderHeader").getString("DocumentID"));
	 * 
	 * String jsonPrettyPrintString = xmlJSONObj.toString(4);
	 * //System.out.println(jsonPrettyPrintString); } catch (JSONException je) {
	 * //System.out.println(je.toString()); }
	 * 
	 * }
	 */

}
